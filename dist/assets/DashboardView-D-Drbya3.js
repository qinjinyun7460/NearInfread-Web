import{A as e,C as t,D as n,M as r,P as i,S as a,T as o,_ as s,a as c,b as l,c as u,h as ee,j as d,k as f,m as p,n as m,p as h,r as te,t as g,u as ne,v as re,w as ie,x as ae,y as oe}from"./index-oNPrC9uc.js";const _=e=>({backgroundColor:`transparent`,tooltip:{trigger:`axis`,textStyle:{fontSize:12},formatter:`{b}<br/>新增样品: {c}`},grid:{left:`5%`,right:`5%`,bottom:`10%`,top:`5%`,containLabel:!0},xAxis:{type:`category`,data:e.map(e=>e.date),axisLabel:{fontSize:11}},yAxis:{type:`value`,min:0,axisLine:{show:!1},axisLabel:{fontSize:11}},series:[{data:e.map(e=>e.count),type:`line`,smooth:!0,symbol:`circle`,symbolSize:6,lineStyle:{width:3,color:new m(0,0,1,0,[{offset:0,color:`#409EFF`},{offset:1,color:`#66B1FF`}])},areaStyle:{color:new m(0,0,0,1,[{offset:0,color:`rgba(64, 158, 255, 0.3)`},{offset:1,color:`rgba(64, 158, 255, 0.05)`}])},itemStyle:{color:`#409EFF`,borderColor:`#fff`,borderWidth:1},emphasis:{symbolSize:10}}]}),v=e=>({backgroundColor:`transparent`,tooltip:{trigger:`axis`,textStyle:{fontSize:12},formatter:`{b}<br/>完成检测: {c}`},grid:{left:`5%`,right:`5%`,bottom:`10%`,top:`5%`,containLabel:!0},xAxis:{type:`category`,data:e.map(e=>e.date),axisLabel:{fontSize:11}},yAxis:{type:`value`,min:0,axisLine:{show:!1},axisLabel:{fontSize:11}},series:[{data:e.map(e=>e.count),type:`line`,smooth:!0,symbol:`circle`,symbolSize:6,lineStyle:{width:3,color:new m(0,0,1,0,[{offset:0,color:`#67C23A`},{offset:1,color:`#85CE61`}])},areaStyle:{color:new m(0,0,0,1,[{offset:0,color:`rgba(103, 194, 58, 0.3)`},{offset:1,color:`rgba(103, 194, 58, 0.05)`}])},itemStyle:{color:`#67C23A`,borderColor:`#fff`,borderWidth:1},emphasis:{symbolSize:10}}]}),y=e=>({backgroundColor:`transparent`,tooltip:{trigger:`item`,textStyle:{fontSize:12},formatter:`{b}: {c} ({d}%)`},legend:{orient:`vertical`,top:`center`,right:`10%`,textStyle:{fontSize:12},itemWidth:10,itemHeight:10},series:[{type:`pie`,radius:[`35%`,`70%`],data:e,label:{show:!0,position:`outside`,fontSize:12,formatter:`{b}: {c}`},itemStyle:{borderRadius:5},emphasis:{scale:!0,scaleSize:5}}],color:[new m(0,0,0,1,[{offset:0,color:`#67C23A`},{offset:1,color:`#85CE61`}]),new m(0,0,0,1,[{offset:0,color:`#E6A23C`},{offset:1,color:`#F0B862`}])]}),b=e=>({backgroundColor:`transparent`,tooltip:{trigger:`item`,textStyle:{fontSize:12},formatter:`{b}: {c} ({d}%)`},legend:{orient:`vertical`,top:`center`,right:`10%`,textStyle:{fontSize:12},itemWidth:10,itemHeight:10},grid:{left:`5%`,right:`5%`,bottom:`15%`,top:`5%`,containLabel:!0},series:[{type:`pie`,radius:[`0%`,`70%`],avoidLabelOverlap:!1,itemStyle:{borderRadius:5},label:{show:!0,position:`outside`,fontSize:12,formatter:`{b}: {c}`},data:e.map((e,t)=>{let n=[{color:[`#409EFF`,`#66B1FF`]},{color:[`#9B87FE`,`#B19FF9`]},{color:[`#F56C6C`,`#F88888`]},{color:[`#E6A23C`,`#F0B862`]},{color:[`#67C23A`,`#85CE61`]},{color:[`#FF7D00`,`#FF9E40`]},{color:[`#8C8C8C`,`#A6A6A6`]},{color:[`#FF5C87`,`#FF85A6`]}],r=n[t%n.length];return{...e,itemStyle:{color:new m(0,0,0,1,[{offset:0,color:r.color[0]},{offset:1,color:r.color[1]}])}}}),emphasis:{scale:!0,scaleSize:10},animationType:`scale`,animationEasing:`elasticOut`,animationDelay:e=>e*50}]});var se={class:`welcome-title`},ce={class:`dashboard-screen`},le={class:`header-left`},ue={class:`header-right`},de={class:`row row-1`},fe={class:`card`},pe={class:`card-body`},me={class:`stat-value`},he={class:`card`},ge={class:`card-body`},_e={class:`stat-value`},ve={class:`card`},ye={class:`card-body`},be={class:`stat-value`},xe={class:`card`},Se={class:`card-body`},Ce={class:`stat-value`},x={class:`row row-line`},S={class:`card chart-card`},C={class:`card-body`},w={class:`card chart-card ratio-chart-card`},T={class:`card-body`},E={class:`ratio-data`},D={class:`ratio-percentage blue`},O={class:`ratio-details`},k={class:`card chart-card`},A={class:`card-body`},we={class:`card chart-card ratio-chart-card`},Te={class:`card-body`},Ee={class:`ratio-data`},De={class:`ratio-percentage green`},Oe={class:`ratio-details`},ke={class:`row row-pie`},Ae={class:`card chart-card`},je={class:`card-body`},Me={class:`card chart-card`},Ne={class:`card-body`},j=p({__name:`DashboardView`,setup(p){let j=h(),M=r({});t(()=>{let e=ne();e?M.value=e:(u.warning(`请先登录`),j.push(`/login`))});let N=r(`today`),P=r([]),Pe=e=>{e!==`custom`&&(P.value=[]),e!==`custom`&&Y()},Fe=e=>{if(e&&e.length===2){let[t,n]=e;if(new Date(t)>new Date(n)){u.warning(`结束日期不能早于开始日期`),P.value=[];return}Y()}},F=d({totalSamples:0,totalProcessed:0,newSamples:0,processedSamples:0,currentProcessedCount:0,processRate:0,increaseRate:0,processedCountRate:0}),I=r(``),L=r(null),R=r(null),z=r(null),B=r(null),V=r(null),H=r(null),U=null,W=null,G=null,K=null,q=null,J=null,Y=async()=>{try{let e={};if(N.value===`custom`){if(!P.value.length){u.warning(`请选择自定义日期范围`);return}let[t,n]=P.value;e.range_type=`custom`,e.start_date=t,e.end_date=n}else e.range_type=N.value;let t=await c.get(`/api/dashboard/stats_total`,{params:e});if(t.data.success){let{summary:e,charts:n}=t.data.data;Object.assign(F,e),Le(n),I.value=te(new Date)}}catch(e){console.error(`获取仪表盘数据失败:`,e),u.error(`获取数据失败，请刷新重试`)}},Ie=()=>{L.value&&(U=g(L.value),U.setOption(_([]))),R.value&&(W=g(R.value),W.setOption(v([]))),z.value&&(G=g(z.value),G.setOption(y([]))),B.value&&(K=g(B.value),K.setOption(b([]))),V.value&&(q=g(V.value),Q()),H.value&&(J=g(H.value),$())},Le=e=>{U&&e?.sampleTrend&&U.setOption(_(e.sampleTrend)),W&&e?.detectTrend&&W.setOption(v(e.detectTrend)),G&&e?.sampleStatus&&G.setOption(y(e.sampleStatus)),K&&e?.locationResult&&K.setOption(b(e.locationResult))},X=()=>{Y(),u.success(`数据已刷新`)},Z=()=>{U&&U.resize(),W&&W.resize(),G&&G.resize(),K&&K.resize(),q&&q.resize(),J&&J.resize()};t(()=>{Ie(),Y(),setInterval(X,3e5),window.addEventListener(`resize`,Z)}),ie(()=>{window.removeEventListener(`resize`,Z),U&&U.dispose(),W&&W.dispose(),G&&G.dispose(),K&&K.dispose(),q&&q.dispose(),J&&J.dispose()}),f(N,()=>{N.value!==`custom`&&Y()});let Q=()=>{let e=F.newSamples||0,t=Math.max(0,(F.totalSamples||0)-e),n={backgroundColor:`transparent`,series:[{type:`pie`,radius:[`60%`,`80%`],center:[`50%`,`50%`],silent:!0,label:{show:!1},labelLine:{show:!1},data:[{value:e,name:`新增样品`,itemStyle:{color:new m(0,0,0,1,[{offset:0,color:`#409EFF`},{offset:1,color:`#66B1FF`}]),borderRadius:4}},{value:t,name:`原有样品`,itemStyle:{color:`#ccc`,borderRadius:4}}],animationDuration:1e3,animationEasing:`cubicOut`}]};q.setOption(n)},$=()=>{let e=F.currentProcessedCount||0,t=Math.max(0,(F.totalProcessed||0)-e),n={backgroundColor:`transparent`,series:[{type:`pie`,radius:[`60%`,`80%`],center:[`50%`,`50%`],silent:!0,label:{show:!1},labelLine:{show:!1},data:[{value:e,name:`当前检测次数`,itemStyle:{color:new m(0,0,1,0,[{offset:0,color:`#67C23A`},{offset:1,color:`#85CE61`}]),borderRadius:4}},{value:t,name:`其余检测次数`,itemStyle:{color:`#ccc`,borderRadius:4}}],animationDuration:1e3,animationEasing:`cubicOut`}]};J.setOption(n)};return f([()=>F.newSamples,()=>F.totalSamples],()=>{q&&Q()}),f([()=>F.currentProcessedCount,()=>F.totalProcessed],()=>{J&&$()}),(t,r)=>{let c=n(`el-card`),u=n(`el-date-picker`),d=n(`el-option`),f=n(`el-select`),p=n(`el-button`),m=n(`el-header`),h=n(`el-main`);return o(),l(ee,null,[a(c,{class:`welcome-card`},{default:e(()=>[s(`h1`,se,`欢迎来到该系统，`+i(M.value.user_name)+`！`,1),r[2]||=s(`p`,{class:`welcome-desc`},`这里是系统首页，可快速查看数据统计`,-1)]),_:1}),a(c,{class:`features-section`,shadow:`never`},{default:e(()=>[r[14]||=s(`h2`,{class:`section-title`},`数据统计`,-1),s(`div`,ce,[a(m,{class:`screen-header`},{default:e(()=>[s(`div`,le,[s(`span`,null,`数据更新时间：`+i(I.value),1)]),s(`div`,ue,[N.value===`custom`?(o(),re(u,{key:0,modelValue:P.value,"onUpdate:modelValue":r[0]||=e=>P.value=e,type:`daterange`,"range-separator":`至`,"start-placeholder":`开始日期`,"end-placeholder":`结束日期`,format:`YYYY-MM-DD`,"value-format":`YYYY-MM-DD`,size:`small`,onChange:Fe,class:`custom-date-picker`},null,8,[`modelValue`])):oe(``,!0),a(f,{modelValue:N.value,"onUpdate:modelValue":r[1]||=e=>N.value=e,onChange:Pe,size:`small`,class:`date-range-select`},{default:e(()=>[a(d,{label:`今日`,value:`today`}),a(d,{label:`本周`,value:`week`}),a(d,{label:`本月`,value:`month`}),a(d,{label:`全年`,value:`year`}),a(d,{label:`自定义日期`,value:`custom`})]),_:1},8,[`modelValue`]),a(p,{onClick:X,icon:`Refresh`,size:`small`},{default:e(()=>[...r[3]||=[ae(`刷新`,-1)]]),_:1})])]),_:1}),a(h,{class:`screen-content`},{default:e(()=>[s(`div`,de,[s(`div`,fe,[r[4]||=s(`span`,{class:`card-title`},`新增样品数量`,-1),s(`div`,pe,[s(`div`,me,i(F.newSamples),1)])]),s(`div`,he,[r[5]||=s(`span`,{class:`card-title`},`检测新增样品数量`,-1),s(`div`,ge,[s(`div`,_e,i(F.processedSamples),1)])]),s(`div`,ve,[r[6]||=s(`span`,{class:`card-title`},`当前检测次数`,-1),s(`div`,ye,[s(`div`,be,i(F.currentProcessedCount),1)])]),s(`div`,xe,[r[7]||=s(`span`,{class:`card-title`},`新样品检测率`,-1),s(`div`,Se,[s(`div`,Ce,i(F.processRate)+`%`,1)])])]),s(`div`,x,[s(`div`,S,[r[8]||=s(`span`,{class:`card-title`},`样品新增趋势`,-1),s(`div`,C,[s(`div`,{ref_key:`sampleTrendChart`,ref:L,class:`chart-container`},null,512)])]),s(`div`,w,[r[9]||=s(`span`,{class:`card-title`},`新增样品占比`,-1),s(`div`,T,[s(`div`,{ref_key:`ratioChart`,ref:V,class:`chart-container`},null,512),s(`div`,E,[s(`div`,D,i(F.increaseRate)+`%`,1),s(`div`,O,[s(`span`,null,`新增: `+i(F.newSamples),1),s(`span`,null,`总计: `+i(F.totalSamples),1)])])])]),s(`div`,k,[r[10]||=s(`span`,{class:`card-title`},`检测完成趋势`,-1),s(`div`,A,[s(`div`,{ref_key:`detectTrendChart`,ref:R,class:`chart-container`},null,512)])]),s(`div`,we,[r[11]||=s(`span`,{class:`card-title`},`当前检测次数占比`,-1),s(`div`,Te,[s(`div`,{ref_key:`processedCountChart`,ref:H,class:`chart-container`},null,512),s(`div`,Ee,[s(`div`,De,i(F.processedCountRate)+`%`,1),s(`div`,Oe,[s(`span`,null,`当前检测次数: `+i(F.currentProcessedCount),1),s(`span`,null,`总计: `+i(F.totalProcessed),1)])])])])]),s(`div`,ke,[s(`div`,Ae,[r[12]||=s(`span`,{class:`card-title`},`样品检测状态分布`,-1),s(`div`,je,[s(`div`,{ref_key:`statusChart`,ref:z,class:`chart-container`},null,512)])]),s(`div`,Me,[r[13]||=s(`span`,{class:`card-title`},`采样地点分布`,-1),s(`div`,Ne,[s(`div`,{ref_key:`locationChart`,ref:B,class:`chart-container`},null,512)])])])]),_:1})])]),_:1})],64)}}},[[`__scopeId`,`data-v-0da9f690`]]);export{j as default};