import{A as e,C as t,D as n,M as r,P as i,S as a,T as o,_ as s,b as c,c as l,j as u,k as d,m as f,o as p,p as m,v as h,w as g,x as _}from"./index-oNPrC9uc.js";var v=[];for(let e=0;e<256;++e)v.push((e+256).toString(16).slice(1));function y(e,t=0){return(v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+`-`+v[e[t+4]]+v[e[t+5]]+`-`+v[e[t+6]]+v[e[t+7]]+`-`+v[e[t+8]]+v[e[t+9]]+`-`+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]).toLowerCase()}var b,x=new Uint8Array(16);function S(){if(!b){if(typeof crypto>`u`||!crypto.getRandomValues)throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);b=crypto.getRandomValues.bind(crypto)}return b(x)}var C={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function w(e,t,n){e||={};let r=e.random??e.rng?.()??S();if(r.length<16)throw Error(`Random bytes length must be >= 16`);if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(n||=0,n<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return y(r)}function T(e,t,n){return C.randomUUID&&!t&&!e?C.randomUUID():w(e,t,n)}var E=T,D={class:`captcha-wrap`},O=[`src`],k={class:`refresh-tip`},A=f({__name:`CaptchaComponent`,props:{apiBase:{type:String,required:!0,default:`http://127.0.0.1:5000`}},emits:[`update:captchaUuid`,`update:captchaValue`],setup(e,{emit:l}){let u=e,f=l,p=r(``),m=r(``),h=r(``),_=r(60),v=r(null),y=r(null),b=()=>{v.value&&clearInterval(v.value);let e=E(),t=Date.now();p.value=e,m.value=`${u.apiBase}/api/captcha?uuid=${e}&t=${t}`,f(`update:captchaUuid`,p.value),_.value=60,v.value=setInterval(b,6e4)},x=()=>{f(`update:captchaValue`,``)};return d(h,e=>{f(`update:captchaValue`,e)}),t(()=>{b(),y.value=setInterval(()=>{_.value>0&&_.value--},1e3)}),g(()=>{v.value&&clearInterval(v.value),y.value&&clearInterval(y.value)}),(e,t)=>{let r=n(`el-input`);return o(),c(`div`,D,[a(r,{modelValue:h.value,"onUpdate:modelValue":t[0]||=e=>h.value=e,placeholder:`请输入验证码`,"prefix-icon":`Check`,size:`large`,clearable:``,class:`captcha-input`,onClear:x},null,8,[`modelValue`]),s(`div`,{class:`captcha-img-box`,onClick:b},[s(`img`,{src:m.value,alt:`验证码`,class:`captcha-img`,onError:b},null,40,O),s(`span`,k,i(_.value)+`秒后自动刷新 `,1)])])}}},[[`__scopeId`,`data-v-26208497`]]),j={class:`form-actions`},M=`http://127.0.0.1:5000`,N=f({__name:`LoginForm`,emits:[`loginSuccess`],setup(t,{emit:i}){let c=i,d=r(null),f=r(!1),m=u({account:``,password:``,captcha:``,remember:!1,captcha_uuid:``}),g=u({account:[{required:!0,message:`请输入手机号或邮箱`,trigger:`blur`},{pattern:/(^\d{11}$)|(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$)/,message:`请输入正确的格式`,trigger:`blur`}],password:[{required:!0,message:`请输入密码`,trigger:`blur`},{min:6,message:`密码长度不能少于6位`,trigger:`blur`}],captcha:[{required:!0,message:`请输入验证码`,trigger:`blur`},{min:4,max:4,message:`验证码长度为4位`,trigger:`blur`}]}),v=async()=>{try{await d.value.validate(),f.value=!0;let e={tel:m.tel,email:m.email,password:m.password,captcha:m.captcha.toLowerCase(),captcha_uuid:m.captcha_uuid};m.account.includes(`@`)?e.email=m.account:e.tel=m.account;let t=await p.post(`${M}/api/user/login`,e);if(t.data.success){l.success(`登录成功`);let e=m.remember?localStorage:sessionStorage,n=t.data.data.user;e.setItem(`userInfo`,JSON.stringify(n));let r=t.data.data.user.user_id;r?(e.setItem(`current_user_id`,r),e.setItem(`role`,t.data.data.user.role)):l.error(`登录失败: 未获取到用户ID`),c(`loginSuccess`)}else l.error(t.data.message||`登录失败`)}catch(e){console.error(`登录错误:`,e);let t=e.response?.data?.message||`网络错误，请检查后端`;l.error(t)}finally{f.value=!1}};return(t,r)=>{let i=n(`el-input`),c=n(`el-form-item`),l=n(`el-checkbox`),u=n(`el-button`),p=n(`el-form`);return o(),h(p,{ref_key:`loginFormRef`,ref:d,model:m,rules:g,class:`auth-form`},{default:e(()=>[a(c,{prop:`account`},{default:e(()=>[a(i,{modelValue:m.account,"onUpdate:modelValue":r[0]||=e=>m.account=e,placeholder:`手机号或邮箱`,"prefix-icon":`User`,size:`large`,clearable:``},null,8,[`modelValue`])]),_:1}),a(c,{prop:`password`},{default:e(()=>[a(i,{modelValue:m.password,"onUpdate:modelValue":r[1]||=e=>m.password=e,type:`password`,placeholder:`密码`,"prefix-icon":`Lock`,"show-password":``,size:`large`,clearable:``},null,8,[`modelValue`])]),_:1}),a(c,{prop:`captcha`},{default:e(()=>[a(A,{"api-base":M,captchaUuid:m.captcha_uuid,"onUpdate:captchaUuid":r[2]||=e=>m.captcha_uuid=e,captchaValue:m.captcha,"onUpdate:captchaValue":r[3]||=e=>m.captcha=e},null,8,[`captchaUuid`,`captchaValue`])]),_:1}),s(`div`,j,[a(l,{modelValue:m.remember,"onUpdate:modelValue":r[4]||=e=>m.remember=e},{default:e(()=>[...r[5]||=[_(`记住我`,-1)]]),_:1},8,[`modelValue`])]),a(c,null,{default:e(()=>[a(u,{type:`primary`,onClick:v,class:`submit-btn`,size:`large`,loading:f.value},{default:e(()=>[...r[6]||=[_(` 登录 `,-1)]]),_:1},8,[`loading`])]),_:1})]),_:1},8,[`model`,`rules`])}}},[[`__scopeId`,`data-v-a28ae4f3`]]),P=`http://127.0.0.1:5000`,F=f({__name:`RegisterForm`,emits:[`registerSuccess`],setup(t,{emit:i}){let s=i,c=r(null),d=r(!1),f=u({account:``,password:``,captcha:``,captcha_uuid:``}),m=u({account:[{required:!0,message:`请输入手机号或邮箱`,trigger:`blur`},{pattern:/(^\d{11}$)|(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$)/,message:`请输入正确的格式`,trigger:`blur`}],password:[{required:!0,message:`请设置密码`,trigger:`blur`},{min:6,message:`密码长度不能少于6位`,trigger:`blur`}],captcha:[{required:!0,message:`请输入验证码`,trigger:`blur`},{min:4,max:4,message:`验证码长度为4位`,trigger:`blur`}]}),g=async()=>{try{await c.value.validate(),d.value=!0;let e={account:f.account,password:f.password,captcha:f.captcha.toLowerCase(),captcha_uuid:f.captcha_uuid};f.account.includes(`@`)?e.email=f.account:e.tel=f.account;let{data:t}=await p.post(`${P}/api/user/register`,e);t.success?(l.success(`注册成功，请登录`),s(`registerSuccess`)):l.error(t.message||`注册失败`)}catch(e){console.error(`注册错误:`,e);let t=e.response?.data?.message||`网络错误，请检查后端`;l.error(t)}finally{d.value=!1}};return(t,r)=>{let i=n(`el-input`),s=n(`el-form-item`),l=n(`el-button`),u=n(`el-form`);return o(),h(u,{ref_key:`registerFormRef`,ref:c,model:f,rules:m,class:`auth-form`},{default:e(()=>[a(s,{prop:`tel`},{default:e(()=>[a(i,{modelValue:f.tel,"onUpdate:modelValue":r[0]||=e=>f.tel=e,placeholder:`手机号`,"prefix-icon":`Cellphone`,size:`large`,clearable:``},null,8,[`modelValue`])]),_:1}),a(s,{prop:`email`},{default:e(()=>[a(i,{modelValue:f.email,"onUpdate:modelValue":r[1]||=e=>f.email=e,placeholder:`邮箱`,"prefix-icon":`Message`,size:`large`,clearable:``},null,8,[`modelValue`])]),_:1}),a(s,{prop:`password`},{default:e(()=>[a(i,{modelValue:f.password,"onUpdate:modelValue":r[2]||=e=>f.password=e,type:`password`,placeholder:`设置密码（至少6位）`,"prefix-icon":`Lock`,"show-password":``,size:`large`,clearable:``},null,8,[`modelValue`])]),_:1}),a(s,{prop:`captcha`},{default:e(()=>[a(A,{"api-base":P,captchaUuid:f.captcha_uuid,"onUpdate:captchaUuid":r[3]||=e=>f.captcha_uuid=e,captchaValue:f.captcha,"onUpdate:captchaValue":r[4]||=e=>f.captcha=e},null,8,[`captchaUuid`,`captchaValue`])]),_:1}),a(s,null,{default:e(()=>[a(l,{type:`primary`,onClick:g,class:`submit-btn`,size:`large`,loading:d.value},{default:e(()=>[...r[5]||=[_(` 注册 `,-1)]]),_:1},8,[`loading`])]),_:1})]),_:1},8,[`model`,`rules`])}}},[[`__scopeId`,`data-v-7a5d174f`]]),I={class:`auth-page`},L={class:`auth-card`},R={class:`auth-header`},z={class:`title`},B={class:`mode-switch`},V=f({__name:`LoginView`,setup(t){let l=m(),u=r(!0),d=()=>{u.value=!u.value},f=()=>{l.push(`/`)};return(t,r)=>{let l=n(`el-link`);return o(),c(`div`,I,[s(`div`,L,[s(`div`,R,[s(`h2`,z,i(u.value?`账号登录`:`用户注册`),1)]),u.value?(o(),h(N,{key:0,onLoginSuccess:f})):(o(),h(F,{key:1,onRegisterSuccess:d})),s(`div`,B,[s(`span`,null,i(u.value?`还没有账号?`:`已有账号?`),1),a(l,{type:`primary`,onClick:d,class:`switch-link`},{default:e(()=>[_(i(u.value?`立即注册`:`立即登录`),1)]),_:1})])])])}}},[[`__scopeId`,`data-v-9154b467`]]);export{V as default};